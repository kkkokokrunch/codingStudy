## XSS 跨站脚本攻击

### 理解 XSS 的攻击方式

1. 反射型
   1. 发出请求时，XSS 代码出现在 URL 中，作为输入提交到服务器端
   2. 服务器端解析后响应，XSS 代码随着相应内容一起传回给浏览器
   3. 最后浏览器解析执行 XSS 代码
2. 存储型
   1. 存储性 XSS 和反射型 XSS 的差别仅在于，提交的代码会存储在服务器端（数据库，内存，文件系统等）
   2. 下次请求目标页面时不用再提交 XSS 代码。

### XSS 的防御措施

1. 编码
   对用户输入的数据进行 Entity 转义
2. 过滤
   移除用户上传的 DOM 属性，如 onerror 等  
   移除用户上传的 Style 节点，Script 节点，Iframe 节点等
3. 校正
   避免直接对 HTML Entity 解码
   使用 DOM Parse 转换，校正不配对的 DOM 标签





## CSRF 跨站请求伪造

### CSRF攻击方式

CSRF就是利用你所在网站的登录的状态，悄悄提交各种信息， 是一种比xss还要恶劣很多的攻击。因为CSRF可以在我们不知情的情况下，利用我们登陆的账号信息，去模拟我们的行为，去执行一下操作，也就是所谓的钓鱼。比如我们在登陆某个论坛，但这个网站是个钓鱼网站，我们利用邮箱或者qq登陆后，它就可以拿到我们的登陆态，session和cookie信息。然后利用这些信息去模拟一个另外网站的请求，比如转账的请求。

![](C:\Users\5520\Pictures\14717762-43cc7ae8f7e7504f.webp)



### CSRF防御措施

1. **在请求地址中添加 token 并验证** 

   要抵御 CSRF，关键在于在请求中放入黑客所不能伪造的信息，并且该信息不存在于 cookie 之中。可以在 HTTP 请求中以参数的形式加入一个随机产生的 token，并在服务器端建立一个拦截器来验证这个 token，如果请求中没有 token 或者 token 内容不正确，则认为可能是 CSRF 攻击而拒绝该请求。 

2. **验证 HTTP Referer 字段**

   ​        根据 HTTP 协议，在 HTTP 头中有一个字段叫 Referer，它记录了该 HTTP 请求的来源地址。在通常情况下，访问一个安全受限页面的请求来自于同一个网站，比如需要访问 http://bank.example/withdraw?account=bob&amount=1000000&for=Mallory，用户必须先登陆 bank.example，然后通过点击页面上的按钮来触发转账事件。这时，该转帐请求的 Referer 值就会是转账按钮所在的页面的 URL，通常是以 bank.example 域名开头的地址。而如果黑客要对银行网站实施 CSRF 攻击，他只能在他自己的网站构造请求，当用户通过黑客的网站发送请求到银行时，该请求的 Referer 是指向黑客自己的网站。因此，要防御 CSRF 攻击，银行网站只需要对于每一个转账请求验证其 Referer 值，如果是以 bank.example 开头的域名，则说明该请求是来自银行网站自己的请求，是合法的。如果 Referer 是其他网站的话，则有可能是黑客的 CSRF 攻击，拒绝该请求。



